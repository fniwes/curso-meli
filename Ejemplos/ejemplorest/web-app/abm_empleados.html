<!DOCTYPE html>
<html>
<head>
	<title>ABM Empleados</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
	<script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
</head>
<body class="container" style="width: 60%;">
	<table class="table">
		<thead>
			<tr>
				<th>Nombre</th><th>Apellido</th><th>Cumplea&ntilde;os</th><th>Acciones</th>
			</tr>
		</thead>
		<tbody id="empleadoList">
			<!-- Agregar aquí empleados -->
		</tbody>
	</table>

	<form id="formCreate">
		<div class="form-group">
			<label>Nombre</label>
			<input class="form-control" type="text" name="nombre" id="txtnombre" />
		</div>
		<div class="form-group">
			<label>Apellido</label>
			<input class="form-control" type="text" name="apellido" id="txtapellido" />
		</div>
		<div class="form-group">
			<label>Nacimiento</label>
			<input class="form-control" type="text" name="nacimiento" id="txtnacimiento" />
		</div>
		<div class="form-group">
			<label>Nacimiento</label>
			<input class="form-control" type="text" name="nacimiento" id="txtnacimiento" />
		</div>
		<button type="button" class="btn btn-primary" id="btnCrear">Crear empleado</button>
	</form>

	<script type="text/template" id="rowTemplate">
		<tr id="row#id">
			<td>#nombre</td>
			<td>#apellido</td>
			<td>#cumpleanos</td>
			<td><a href="#" onclick="borrarEmpleado(#id)"><span class="glyphicon glyphicon-remove"></span></a></td>
		</tr>
	</script>

	<script>
		function listar() {
			$.get("/ejemplorest/empleado.json")
				.done( function(data) {
					$("#empleadoList").empty();
					$.each(data, agregarEmpleado);
				});
		}

		function agregarEmpleado(index, empleado) {
			var str = $("#rowTemplate").html();

			str = str.replace("#nombre", empleado.name);
			str = str.replace("#apellido", empleado.lastname);
			str = str.replace("#cumpleanos", empleado.birthday);

			// Notar que como queremos reemplazar varias veces el texto #id (se usa en al menos dos lugares)
			// tenemos que hacerlo como un "regular expression", donde la g final significa reemplazar todas
			// las veces. De lo contrario sólo se reemplazará la primera ocurrencia
			str = str.replace(/#id/g, empleado.id);

			$("#empleadoList").append(str);
		}

		function borrarEmpleado(idEmpleado) {
			var promise = $.ajax("/ejemplorest/empleado/" + idEmpleado + ".json", { method: "DELETE" });
			promise.done(function() {
				// Cuando se confirma que se borro el empleado, lo quitamos de la tabla, pero para eso
				// necesitamos poder identificar la fila, por eso agegamos un id a cada fila
				$("#row"+idEmpleado).remove();
			});
		}

		$("#btnCrear").click(function() {
			var json = {
				name: $("#txtnombre").val(),
				lastname: $("#txtapellido").val(),
				birthday: $("#txtnacimiento").val(),
			}

			var promise = $.ajax("/ejemplorest/empleado.json", {
				method: "post",
				contentType: 'application/json; charset=utf-8',
				data: JSON.stringify(json)
			});

			promise.done(function(empleado) {
				agregarEmpleado(0, empleado)
			})
		});

		listar();
	</script>
</body>
</html>